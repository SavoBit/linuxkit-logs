[INFO    ] 2017-05-16T12:44:41.471931746Z: Running Test linuxkit.config.kmod in /tmp/build/test/cases/000_config/010_kmod
[INFO    ] 2017-05-16T12:44:41.472053954Z: Running command: [/bin/sh -x /tmp/build/test/cases/000_config/010_kmod/test.sh]
[STDERR  ] 2017-05-16T12:44:41.472858203Z: + set -e
[STDERR  ] 2017-05-16T12:44:41.472926592Z: + . /tmp/build/test/cases/_lib/lib.sh
[STDERR  ] 2017-05-16T12:44:41.47295916Z: + [ -f src/github.com/linuxkit/rtf/lib/lib.sh ]
[STDERR  ] 2017-05-16T12:44:41.472972912Z: + LINUXKIT_TMPDIR=/tmp/build/test/cases/_tmp
[STDERR  ] 2017-05-16T12:44:41.472991309Z: + LINUXKIT_ARTIFACTS_DIR=/tmp/build/test/cases/../../artifacts
[STDERR  ] 2017-05-16T12:44:41.473004393Z: + [ -f /tmp/build/test/cases/_tmp/env.sh ]
[STDERR  ] 2017-05-16T12:44:41.473018348Z: + . /tmp/build/test/cases/_tmp/env.sh
[STDERR  ] 2017-05-16T12:44:41.473034674Z: + export LINUXKIT_EXAMPLES_DIR=/tmp/build/test/cases/../../examples
[STDERR  ] 2017-05-16T12:44:41.473045836Z: + RT_CANCEL=253
[STDERR  ] 2017-05-16T12:44:41.473054712Z: + IMAGE_NAME=kmod-test
[STDERR  ] 2017-05-16T12:44:41.47307064Z: + trap clean_up EXIT
[STDERR  ] 2017-05-16T12:44:41.473083577Z: + docker pull linuxkit/kernel:4.9.x
[STDOUT  ] 2017-05-16T12:44:42.695851548Z: 4.9.x: Pulling from linuxkit/kernel
[STDOUT  ] 2017-05-16T12:44:42.695880601Z: Digest: sha256:dd706d391fddc3d2efc254a6c03223d6cb82b86a3dc059a9264063be2fd8911f
[STDOUT  ] 2017-05-16T12:44:42.695907638Z: Status: Image is up to date for linuxkit/kernel:4.9.x
[STDERR  ] 2017-05-16T12:44:42.69700991Z: + docker build -t kmod-test .
[STDOUT  ] 2017-05-16T12:44:42.714684143Z: Sending build context to Docker daemon  9.216kB
[STDOUT  ] 2017-05-16T12:44:42.866447368Z: Step 1/11 : FROM linuxkit/kernel:4.9.x AS ksrc
[STDOUT  ] 2017-05-16T12:44:42.866735732Z:  ---> cc9f6cd19506
[STDOUT  ] 2017-05-16T12:44:42.866828702Z: Step 2/11 : FROM linuxkit/kernel-compile:1b396c221af673757703258159ddc8539843b02b@sha256:6b32d205bfc6407568324337b707d195d027328dbfec554428ea93e7b0a8299b AS build
[STDOUT  ] 2017-05-16T12:44:44.028031788Z: 1b396c221af673757703258159ddc8539843b02b: Pulling from linuxkit/kernel-compile
[STDOUT  ] 2017-05-16T12:44:44.028189744Z: 627beaf3eaaf: Already exists
[STDOUT  ] 2017-05-16T12:44:44.035284858Z: 26dc4067def6: Pulling fs layer
[STDOUT  ] 2017-05-16T12:44:47.528083345Z: 26dc4067def6: Download complete
[STDOUT  ] 2017-05-16T12:44:53.221776841Z: 26dc4067def6: Pull complete
[STDOUT  ] 2017-05-16T12:44:53.232313816Z: Digest: sha256:6b32d205bfc6407568324337b707d195d027328dbfec554428ea93e7b0a8299b
[STDOUT  ] 2017-05-16T12:44:53.23655576Z: Status: Downloaded newer image for linuxkit/kernel-compile:1b396c221af673757703258159ddc8539843b02b@sha256:6b32d205bfc6407568324337b707d195d027328dbfec554428ea93e7b0a8299b
[STDOUT  ] 2017-05-16T12:44:53.237099879Z:  ---> 261c60c4eb02
[STDOUT  ] 2017-05-16T12:44:53.237116636Z: Step 3/11 : COPY --from=ksrc /kernel-dev.tar /
[STDOUT  ] 2017-05-16T12:44:55.075571776Z:  ---> 04580f880f84
[STDOUT  ] 2017-05-16T12:44:55.091398734Z: Removing intermediate container 6d3300e21ce0
[STDOUT  ] 2017-05-16T12:44:55.091416936Z: Step 4/11 : RUN tar xf kernel-dev.tar
[STDOUT  ] 2017-05-16T12:44:55.164327396Z:  ---> Running in 3e3e8198d2bc
[STDOUT  ] 2017-05-16T12:45:00.327530936Z:  ---> 832026a4754e
[STDOUT  ] 2017-05-16T12:45:00.664974491Z: Removing intermediate container 3e3e8198d2bc
[STDOUT  ] 2017-05-16T12:45:00.664991344Z: Step 5/11 : WORKDIR /kmod
[STDOUT  ] 2017-05-16T12:45:00.938715912Z:  ---> 5d2f5f05b6e1
[STDOUT  ] 2017-05-16T12:45:00.950208686Z: Removing intermediate container e9e4094fa9fc
[STDOUT  ] 2017-05-16T12:45:00.950216727Z: Step 6/11 : COPY ./src/* ./
[STDOUT  ] 2017-05-16T12:45:01.436852704Z:  ---> 60736cc4c007
[STDOUT  ] 2017-05-16T12:45:01.446683573Z: Removing intermediate container fda8340e49de
[STDOUT  ] 2017-05-16T12:45:01.446710831Z: Step 7/11 : RUN make all
[STDOUT  ] 2017-05-16T12:45:01.534383852Z:  ---> Running in ed779a3ffc31
[STDOUT  ] 2017-05-16T12:45:01.85310469Z: make -C /usr/src/linux-headers-4.9.28-linuxkit M=/kmod modules
[STDOUT  ] 2017-05-16T12:45:01.854310078Z: make[1]: Entering directory '/usr/src/linux-headers-4.9.28-linuxkit'
[STDOUT  ] 2017-05-16T12:45:02.633135852Z:   CC [M]  /kmod/hello_world.o
[STDOUT  ] 2017-05-16T12:45:02.80737297Z:   Building modules, stage 2.
[STDOUT  ] 2017-05-16T12:45:02.815499974Z:   MODPOST 1 modules
[STDOUT  ] 2017-05-16T12:45:02.826248401Z:   CC      /kmod/hello_world.mod.o
[STDOUT  ] 2017-05-16T12:45:02.986742683Z:   LD [M]  /kmod/hello_world.ko
[STDOUT  ] 2017-05-16T12:45:02.989452834Z: make[1]: Leaving directory '/usr/src/linux-headers-4.9.28-linuxkit'
[STDOUT  ] 2017-05-16T12:45:03.548094402Z:  ---> 8b40c1768814
[STDOUT  ] 2017-05-16T12:45:03.558696086Z: Removing intermediate container ed779a3ffc31
[STDOUT  ] 2017-05-16T12:45:03.558712092Z: Step 8/11 : FROM alpine:3.5
[STDOUT  ] 2017-05-16T12:45:04.672433497Z: 3.5: Pulling from library/alpine
[STDOUT  ] 2017-05-16T12:45:04.672757043Z: cfc728c1c558: Pulling fs layer
[STDOUT  ] 2017-05-16T12:45:05.303377741Z: cfc728c1c558: Verifying Checksum
[STDOUT  ] 2017-05-16T12:45:05.303405419Z: cfc728c1c558: Download complete
[STDOUT  ] 2017-05-16T12:45:05.539467245Z: cfc728c1c558: Pull complete
[STDOUT  ] 2017-05-16T12:45:05.547232278Z: Digest: sha256:c0537ff6a5218ef531ece93d4984efc99bbf3f7497c0a7726c88e2bb7584dc96
[STDOUT  ] 2017-05-16T12:45:05.552176431Z: Status: Downloaded newer image for alpine:3.5
[STDOUT  ] 2017-05-16T12:45:05.552700661Z:  ---> 02674b9cb179
[STDOUT  ] 2017-05-16T12:45:05.552720069Z: Step 9/11 : COPY --from=build /kmod/hello_world.ko /
[STDOUT  ] 2017-05-16T12:45:05.91921161Z:  ---> 39d3b6bc2b69
[STDOUT  ] 2017-05-16T12:45:05.924704064Z: Removing intermediate container a0d8795e3013
[STDOUT  ] 2017-05-16T12:45:05.924721262Z: Step 10/11 : COPY check.sh /check.sh
[STDOUT  ] 2017-05-16T12:45:06.291243184Z:  ---> c33182566c07
[STDOUT  ] 2017-05-16T12:45:06.296735631Z: Removing intermediate container 8b733ec1adf2
[STDOUT  ] 2017-05-16T12:45:06.29674782Z: Step 11/11 : ENTRYPOINT /bin/sh /check.sh
[STDOUT  ] 2017-05-16T12:45:06.366488027Z:  ---> Running in 7b261a243175
[STDOUT  ] 2017-05-16T12:45:06.515901393Z:  ---> b12c4e05d460
[STDOUT  ] 2017-05-16T12:45:06.521449404Z: Removing intermediate container 7b261a243175
[STDOUT  ] 2017-05-16T12:45:06.521519357Z: Successfully built b12c4e05d460
[STDOUT  ] 2017-05-16T12:45:06.525231655Z: Successfully tagged kmod-test:latest
[STDERR  ] 2017-05-16T12:45:06.557261813Z: + moby build kmod
[STDERR  ] 2017-05-16T12:45:06.567759376Z: Extract kernel image: linuxkit/kernel:4.9.x
[STDERR  ] 2017-05-16T12:45:07.066198218Z: Add init containers:
[STDERR  ] 2017-05-16T12:45:07.066216413Z: Process init image: linuxkit/init:b3740303f3d1e5689a84c87b7dfb48fd2a40a192
[STDERR  ] 2017-05-16T12:45:07.205627722Z: Process init image: linuxkit/runc:47b1c38d63468c0f3078f8b1b055d07965a1895d
[STDERR  ] 2017-05-16T12:45:07.36429282Z: Process init image: linuxkit/containerd:cf2614f5a96c569a0bd4bd54e054a65ba17d167f
[STDERR  ] 2017-05-16T12:45:07.730767839Z: Add onboot containers:
[STDERR  ] 2017-05-16T12:45:07.730798183Z:   Create OCI config for kmod-test
[STDERR  ] 2017-05-16T12:45:07.873814978Z:   Create OCI config for linuxkit/poweroff:961412b8ef5c5285de0d40ec076701d955eaa084
[STDERR  ] 2017-05-16T12:45:08.029518401Z: Create outputs:
[STDERR  ] 2017-05-16T12:45:12.366522946Z:   kmod-kernel kmod-initrd.img kmod-cmdline
[STDERR  ] 2017-05-16T12:45:12.418235139Z: + linuxkit run qemu kmod
[STDERR  ] 2017-05-16T12:45:12.418254424Z: + grep -q Hello LinuxKit
[STDERR  ] 2017-05-16T12:45:12.425658424Z: Unable to find qemu-system-x86_64 within the $PATH. Using a container
[STDERR  ] 2017-05-16T12:45:28.143283906Z: write /dev/stdout: broken pipe
[STDERR  ] 2017-05-16T12:45:28.145734401Z: time="2017-05-16T12:45:28Z" level=fatal msg="exit status 1" 
[STDERR  ] 2017-05-16T12:45:28.145754947Z: + clean_up
[STDERR  ] 2017-05-16T12:45:28.145770641Z: + docker rmi kmod-test
[STDOUT  ] 2017-05-16T12:45:28.16722919Z: Untagged: kmod-test:latest
[STDOUT  ] 2017-05-16T12:45:28.167249823Z: Deleted: sha256:b12c4e05d460e9a8490103788bb304b75b9d35bd12f30402046dd534ec735e33
[STDOUT  ] 2017-05-16T12:45:28.167272572Z: Deleted: sha256:c33182566c074e95139adeb4c73270d11bfc830dc6007dc282935edb21d490b8
[STDOUT  ] 2017-05-16T12:45:28.167288856Z: Deleted: sha256:611023d0165ba0e73ae8b93765bae3a178da94e3acd2ddd9616f62a242b66230
[STDOUT  ] 2017-05-16T12:45:28.167296612Z: Deleted: sha256:39d3b6bc2b69ac0dce650154b2d330520184b35afe252ef15fc724ee42718234
[STDOUT  ] 2017-05-16T12:45:28.167307014Z: Deleted: sha256:584d968cb2b96d92905016c0dd424e96ac3dd8f654a9870682378849a4c5703f
[STDERR  ] 2017-05-16T12:45:28.168157305Z: + find . -iname kmod* -not -iname *.yml -exec rm -rf {} ;
[PASS    ] linuxkit.config.kmod 46.71s
