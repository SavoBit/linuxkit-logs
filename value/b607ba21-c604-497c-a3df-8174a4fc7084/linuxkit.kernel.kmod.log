[INFO    ] 2017-05-17T17:38:09.482430243Z: Running Test linuxkit.kernel.kmod in /tmp/build/test/cases/020_kernel/010_kmod
[INFO    ] 2017-05-17T17:38:09.482494935Z: Running command: [/bin/sh -x /tmp/build/test/cases/020_kernel/010_kmod/test.sh]
[STDERR  ] 2017-05-17T17:38:09.509702116Z: + set -e
[STDERR  ] 2017-05-17T17:38:09.509744572Z: + . /tmp/build/test/cases/_lib/lib.sh
[STDERR  ] 2017-05-17T17:38:09.509808762Z: + [ -f src/github.com/linuxkit/rtf/lib/lib.sh ]
[STDERR  ] 2017-05-17T17:38:09.532558312Z: + LINUXKIT_TMPDIR=/tmp/build/test/cases/_tmp
[STDERR  ] 2017-05-17T17:38:09.532607211Z: + [ -f /tmp/build/test/cases/_tmp/env.sh ]
[STDERR  ] 2017-05-17T17:38:09.532638411Z: + . /tmp/build/test/cases/_tmp/env.sh
[STDERR  ] 2017-05-17T17:38:09.532694867Z: + export LINUXKIT_EXAMPLES_DIR=/tmp/build/test/cases/../../examples
[STDERR  ] 2017-05-17T17:38:09.532727297Z: + RT_CANCEL=253
[STDERR  ] 2017-05-17T17:38:09.532752885Z: + IMAGE_NAME=kmod-test
[STDERR  ] 2017-05-17T17:38:09.532782472Z: + trap clean_up EXIT
[STDERR  ] 2017-05-17T17:38:09.532811316Z: + docker pull linuxkit/kernel:4.9.x
[STDOUT  ] 2017-05-17T17:38:10.678028885Z: 4.9.x: Pulling from linuxkit/kernel
[STDOUT  ] 2017-05-17T17:38:10.678165429Z: Digest: sha256:dd706d391fddc3d2efc254a6c03223d6cb82b86a3dc059a9264063be2fd8911f
[STDOUT  ] 2017-05-17T17:38:10.678215768Z: Status: Image is up to date for linuxkit/kernel:4.9.x
[STDERR  ] 2017-05-17T17:38:10.67912582Z: + docker build -t kmod-test .
[STDOUT  ] 2017-05-17T17:38:10.742722906Z: Sending build context to Docker daemon  9.216kB
[STDOUT  ] 2017-05-17T17:38:10.745551833Z: Step 1/11 : FROM linuxkit/kernel:4.9.x AS ksrc
[STDOUT  ] 2017-05-17T17:38:10.777720261Z:  ---> cc9f6cd19506
[STDOUT  ] 2017-05-17T17:38:10.777738799Z: Step 2/11 : FROM linuxkit/kernel-compile:1b396c221af673757703258159ddc8539843b02b@sha256:6b32d205bfc6407568324337b707d195d027328dbfec554428ea93e7b0a8299b AS build
[STDOUT  ] 2017-05-17T17:38:12.011294922Z: 1b396c221af673757703258159ddc8539843b02b: Pulling from linuxkit/kernel-compile
[STDOUT  ] 2017-05-17T17:38:12.011310665Z: 627beaf3eaaf: Already exists
[STDOUT  ] 2017-05-17T17:38:12.018850161Z: 26dc4067def6: Pulling fs layer
[STDOUT  ] 2017-05-17T17:38:15.435793451Z: 26dc4067def6: Verifying Checksum
[STDOUT  ] 2017-05-17T17:38:15.437473782Z: 26dc4067def6: Download complete
[STDOUT  ] 2017-05-17T17:38:21.330843737Z: 26dc4067def6: Pull complete
[STDOUT  ] 2017-05-17T17:38:21.341540069Z: Digest: sha256:6b32d205bfc6407568324337b707d195d027328dbfec554428ea93e7b0a8299b
[STDOUT  ] 2017-05-17T17:38:21.343907472Z: Status: Downloaded newer image for linuxkit/kernel-compile:1b396c221af673757703258159ddc8539843b02b@sha256:6b32d205bfc6407568324337b707d195d027328dbfec554428ea93e7b0a8299b
[STDOUT  ] 2017-05-17T17:38:21.344287875Z:  ---> 261c60c4eb02
[STDOUT  ] 2017-05-17T17:38:21.344366562Z: Step 3/11 : COPY --from=ksrc /kernel-dev.tar /
[STDOUT  ] 2017-05-17T17:38:23.653059284Z:  ---> 190cf9f1df0b
[STDOUT  ] 2017-05-17T17:38:23.676814013Z: Removing intermediate container 156dd71d7372
[STDOUT  ] 2017-05-17T17:38:23.676940719Z: Step 4/11 : RUN tar xf kernel-dev.tar
[STDOUT  ] 2017-05-17T17:38:23.75776318Z:  ---> Running in 5a153c1af793
[STDOUT  ] 2017-05-17T17:38:30.674674326Z:  ---> 697ccc3fd47e
[STDOUT  ] 2017-05-17T17:38:31.039301337Z: Removing intermediate container 5a153c1af793
[STDOUT  ] 2017-05-17T17:38:31.039497095Z: Step 5/11 : WORKDIR /kmod
[STDOUT  ] 2017-05-17T17:38:31.314253322Z:  ---> 4554a17febdc
[STDOUT  ] 2017-05-17T17:38:31.320902834Z: Removing intermediate container e3e3aa2dad78
[STDOUT  ] 2017-05-17T17:38:31.321092126Z: Step 6/11 : COPY ./src/* ./
[STDOUT  ] 2017-05-17T17:38:31.52990267Z:  ---> 29f32410e3c1
[STDOUT  ] 2017-05-17T17:38:31.537221052Z: Removing intermediate container d9bd26c5497f
[STDOUT  ] 2017-05-17T17:38:31.537360349Z: Step 7/11 : RUN make all
[STDOUT  ] 2017-05-17T17:38:31.61171496Z:  ---> Running in c30112e7fc52
[STDOUT  ] 2017-05-17T17:38:31.750944099Z: make -C /usr/src/linux-headers-4.9.28-linuxkit M=/kmod modules
[STDOUT  ] 2017-05-17T17:38:31.752327296Z: make[1]: Entering directory '/usr/src/linux-headers-4.9.28-linuxkit'
[STDOUT  ] 2017-05-17T17:38:32.741569417Z:   CC [M]  /kmod/hello_world.o
[STDOUT  ] 2017-05-17T17:38:32.937672488Z:   Building modules, stage 2.
[STDOUT  ] 2017-05-17T17:38:32.94474766Z:   MODPOST 1 modules
[STDOUT  ] 2017-05-17T17:38:32.955406333Z:   CC      /kmod/hello_world.mod.o
[STDOUT  ] 2017-05-17T17:38:33.133647594Z:   LD [M]  /kmod/hello_world.ko
[STDOUT  ] 2017-05-17T17:38:33.136140626Z: make[1]: Leaving directory '/usr/src/linux-headers-4.9.28-linuxkit'
[STDOUT  ] 2017-05-17T17:38:33.3067706Z:  ---> dc0503b85e6e
[STDOUT  ] 2017-05-17T17:38:33.317346264Z: Removing intermediate container c30112e7fc52
[STDOUT  ] 2017-05-17T17:38:33.317515339Z: Step 8/11 : FROM alpine:3.5
[STDOUT  ] 2017-05-17T17:38:34.436247408Z: 3.5: Pulling from library/alpine
[STDOUT  ] 2017-05-17T17:38:34.450330433Z: cfc728c1c558: Already exists
[STDOUT  ] 2017-05-17T17:38:34.936469548Z: Digest: sha256:c0537ff6a5218ef531ece93d4984efc99bbf3f7497c0a7726c88e2bb7584dc96
[STDOUT  ] 2017-05-17T17:38:34.945731038Z: Status: Downloaded newer image for alpine:3.5
[STDOUT  ] 2017-05-17T17:38:34.946126741Z:  ---> 02674b9cb179
[STDOUT  ] 2017-05-17T17:38:34.94623301Z: Step 9/11 : COPY --from=build /kmod/hello_world.ko /
[STDOUT  ] 2017-05-17T17:38:35.123837714Z:  ---> 183c8dd87162
[STDOUT  ] 2017-05-17T17:38:35.128981669Z: Removing intermediate container 8bdeb521465f
[STDOUT  ] 2017-05-17T17:38:35.129132693Z: Step 10/11 : COPY check.sh /check.sh
[STDOUT  ] 2017-05-17T17:38:35.29380215Z:  ---> 497dc1d27ab0
[STDOUT  ] 2017-05-17T17:38:35.300107058Z: Removing intermediate container a7ab85080aad
[STDOUT  ] 2017-05-17T17:38:35.300265116Z: Step 11/11 : ENTRYPOINT /bin/sh /check.sh
[STDOUT  ] 2017-05-17T17:38:35.370260864Z:  ---> Running in 96e2e2bd6435
[STDOUT  ] 2017-05-17T17:38:35.418988124Z:  ---> 3dd09a5543a0
[STDOUT  ] 2017-05-17T17:38:35.424518543Z: Removing intermediate container 96e2e2bd6435
[STDOUT  ] 2017-05-17T17:38:35.424589369Z: Successfully built 3dd09a5543a0
[STDOUT  ] 2017-05-17T17:38:35.429356485Z: Successfully tagged kmod-test:latest
[STDERR  ] 2017-05-17T17:38:35.440455797Z: + moby build kmod
[STDERR  ] 2017-05-17T17:38:35.450388757Z: Extract kernel image: linuxkit/kernel:4.9.x
[STDERR  ] 2017-05-17T17:38:36.002830117Z: Add init containers:
[STDERR  ] 2017-05-17T17:38:36.002868251Z: Process init image: linuxkit/init:b3740303f3d1e5689a84c87b7dfb48fd2a40a192
[STDERR  ] 2017-05-17T17:38:36.12866203Z: Process init image: linuxkit/runc:47b1c38d63468c0f3078f8b1b055d07965a1895d
[STDERR  ] 2017-05-17T17:38:36.263181657Z: Process init image: linuxkit/containerd:cf2614f5a96c569a0bd4bd54e054a65ba17d167f
[STDERR  ] 2017-05-17T17:38:36.733455781Z: Add onboot containers:
[STDERR  ] 2017-05-17T17:38:36.733504684Z:   Create OCI config for kmod-test
[STDERR  ] 2017-05-17T17:38:36.909980683Z:   Create OCI config for linuxkit/poweroff:961412b8ef5c5285de0d40ec076701d955eaa084
[STDERR  ] 2017-05-17T17:38:37.050873614Z: Create outputs:
[STDERR  ] 2017-05-17T17:38:41.413665455Z:   kmod-kernel kmod-initrd.img kmod-cmdline
[STDERR  ] 2017-05-17T17:38:41.461629409Z: + grep -q Hello LinuxKit
[STDERR  ] 2017-05-17T17:38:41.462571152Z: + linuxkit run qemu kmod
[STDERR  ] 2017-05-17T17:38:41.469635522Z: Unable to find qemu-system-x86_64 within the $PATH. Using a container
[STDERR  ] 2017-05-17T17:38:56.601504298Z: write /dev/stdout: broken pipe
[STDERR  ] 2017-05-17T17:38:56.603237182Z: time="2017-05-17T17:38:56Z" level=fatal msg="exit status 1" 
[STDERR  ] 2017-05-17T17:38:56.603271462Z: + clean_up
[STDERR  ] 2017-05-17T17:38:56.603296107Z: + docker rmi kmod-test
[STDOUT  ] 2017-05-17T17:38:56.639039704Z: Untagged: kmod-test:latest
[STDOUT  ] 2017-05-17T17:38:56.639054353Z: Deleted: sha256:3dd09a5543a05713c760afde3922bef458233bef20c19998cbce102d4b3bcd38
[STDOUT  ] 2017-05-17T17:38:56.639058403Z: Deleted: sha256:497dc1d27ab076969fa3ccf60084b40a51fd27bd223f8d529f319a1f55914028
[STDOUT  ] 2017-05-17T17:38:56.639068168Z: Deleted: sha256:131683d6484e312855422fde70d1400ca98dd95f572a8923dd159d359da52429
[STDOUT  ] 2017-05-17T17:38:56.639074868Z: Deleted: sha256:183c8dd8716225a73b702b531faeca51b6b29d70c57bb349fed5388fecbc0561
[STDOUT  ] 2017-05-17T17:38:56.639086159Z: Deleted: sha256:475fcb65ca0328d659d1241535b04a91bcbbe6ac38c1bed11062a4f78bc74f29
[STDERR  ] 2017-05-17T17:38:56.639842848Z: + find . -iname kmod* -not -iname *.yml -exec rm -rf {} ;
[PASS    ] linuxkit.kernel.kmod 47.18s
