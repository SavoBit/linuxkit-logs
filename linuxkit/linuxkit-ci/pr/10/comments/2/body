As suggested by @talex5, I've added the PR check as a separate pipeline step so it could be cached more easily. The current pipeline becomes:

- pull whitelist from `linuxkit/linuxkit-ci/master/whitelist`
- check that the target (PR, ref) can be built using the information stored in the whitelist
- build and test as it is now