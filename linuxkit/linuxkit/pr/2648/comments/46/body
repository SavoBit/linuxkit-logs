Where/why does this code need to deal with old hashes?

Generating the hash corresponding to a package in the an old revision (by tag or commit ID) is already supported by the pkglib code.