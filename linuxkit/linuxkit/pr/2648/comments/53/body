You shouldn't need `SetCommit` since the only caller outside `pkglib` passes a hardcoded `"HEAD"` and this should be the default in al code paths which don't involve `NewFromCLI`.

Please leave `NewFromCommit` in `pkglib.go` it doesn't require a separate file and moving it makes the review harder.

NB I am holding off doing an in depth review here until the feature is documented so I know the expected behaviour, currently I'm just dipping into things you are mentioning in comments. I'd strongly recommend documenting ASAP before working on the code further, otherwise it is hard to say if you are moving in the right direction at all.