Hmm, I don't like this solution much. I spent quite a bit of time making many of the output formats streamable, so they could be piped into other commands etc. I was thinking that you would just maintain a list of files, and deduplicate at write time, so it could still be streaming (but with a memory overhead for the list to de-dup).
