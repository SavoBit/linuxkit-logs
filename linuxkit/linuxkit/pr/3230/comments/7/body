Thanks for the pointers @tjfontaine I've pushed a few test cases up in the next commit. Once it's ready to merge, I'll squash all commits together.